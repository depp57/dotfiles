- name: Machine setup
  hosts: localhost
  become: true

  tasks:
    - name: Install packages
      package:
        name:
          - curl
          - git
          - htop
          - vim
          - zsh
        state: present

    # https://brave.com/linux/
    - name: Install Brave browser
      block:
        - name: Install Brave browser - Check if GPG key already exists
          stat:
            path: /usr/share/keyrings/brave-browser-archive-keyring.gpg
          register: gpg_key

        - name: Install Brave browser - Download GPG key
          get_url:
            url: https://brave-browser-apt-release.s3.brave.com/brave-browser-archive-keyring.gpg
            dest: /usr/share/keyrings/brave-browser-archive-keyring.gpg
            mode: '0644'
          when: not gpg_key.stat.exists

        - name: Install Brave browser - Add repository
          copy:
            dest: /etc/apt/sources.list.d/brave-browser-release.list
            content: deb [signed-by=/usr/share/keyrings/brave-browser-archive-keyring.gpg] https://brave-browser-apt-release.s3.brave.com/ stable main
            mode: '0644'
          when: not gpg_key.stat.exists

        - name: Install Brave browser - Update apt cache and install Brave
          apt:
            update_cache: yes
            name: brave-browser
            state: present
